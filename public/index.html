<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>WebRTC Video Chat</title>
		<link rel="stylesheet" href="style.css" />
		<link rel="stylesheet" href="mobile-improvements.css" />
	</head>
	<body>
		<div class="app-container">
			<!-- Backdrop para cerrar chat en mobile -->
			<div
				class="chat-backdrop"
				id="chatBackdrop"
				onclick="toggleMobileChat()"
			></div>

			<!-- Sidebar con Chat -->
			<aside class="sidebar" id="chatSection" style="display: none">
				<div class="sidebar-header">
					<h2>Welcome</h2>
					<button
						class="close-chat-btn"
						id="closeChatBtn"
						onclick="toggleMobileChat()"
					>
						<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="20" height="20">
							<line x1="18" y1="6" x2="6" y2="18"></line>
							<line x1="6" y1="6" x2="18" y2="18"></line>
						</svg>
					</button>
					<div class="room-info" id="roomInfo"></div>
				</div>
				<div class="chat-messages" id="chatMessages"></div>
				<div class="chat-input-wrapper">
					<button class="attach-btn" onclick="selectFile()" title="Attach file">
						<svg
							width="20"
							height="20"
							viewBox="0 0 24 24"
							fill="none"
							stroke="currentColor"
							stroke-width="2"
						>
							<path
								d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"
							></path>
						</svg>
					</button>
					<input
						type="text"
						id="chatInput"
						placeholder="Type a message..."
						maxlength="500"
					/>
					<button class="send-btn" onclick="sendMessage()">
						<svg
							width="20"
							height="20"
							viewBox="0 0 24 24"
							fill="none"
							stroke="currentColor"
							stroke-width="2"
						>
							<line x1="22" y1="2" x2="11" y2="13"></line>
							<polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
						</svg>
					</button>
				</div>
			</aside>

			<!-- Contenido Principal -->
			<main class="main-content">
				<header class="app-header">
					<div class="header-content">
						<h1></h1>
						<div class="header-right">
							<button
								class="theme-toggle"
								id="themeToggle"
								onclick="toggleTheme()"
								title="Toggle theme"
							>
								<svg
									id="themeIcon"
									viewBox="0 0 24 24"
									fill="currentColor"
									width="20"
									height="20"
								>
									<path
										d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"
									/>
								</svg>
							</button>
							<div class="header-status" id="headerStatus">Not Connected</div>
						</div>
					</div>
				</header>

				<!-- Loading Screen -->
				<div class="loading-screen" id="loadingScreen" style="display: none;">
					<div class="loading-content">
						<div class="spinner">
							<div class="spinner-ring"></div>
							<div class="spinner-ring"></div>
							<div class="spinner-ring"></div>
						</div>
						<h2 class="loading-text">Reconectando...</h2>
						<p class="loading-subtext">Restaurando tu sesión</p>
					</div>
				</div>

				<!-- Green Room / Pre-join Screen -->
				<div class="join-panel" id="joinPanel">
					<div class="join-card green-room">
						<div class="join-header">
							<h2>Get Ready</h2>
							<p>Setup your camera and microphone</p>
						</div>
						
						<div class="green-room-content">
							<!-- Left Side: Video Preview -->
							<div class="preview-container">
								<video id="previewVideo" autoplay muted playsinline></video>
                                <div id="permissionsOverlay" class="permissions-overlay" onclick="startGreenRoom()">
                                    <div class="perm-btn">
                                        <svg viewBox="0 0 24 24" fill="currentColor" width="32" height="32">
                                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z"/>
                                        </svg>
                                        <span>Start Camera</span>
                                    </div>
                                </div>
								<div class="preview-controls">
									<button class="preview-btn" id="previewAudioBtn" onclick="togglePreviewAudio()" title="Toggle Mic">
										<svg viewBox="0 0 24 24" fill="currentColor">
											<path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
											<path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
										</svg>
									</button>
									<button class="preview-btn" id="previewVideoBtn" onclick="togglePreviewVideo()" title="Toggle Camera">
										<svg viewBox="0 0 24 24" fill="currentColor">
											<path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"/>
										</svg>
									</button>
								</div>
								<div class="audio-level-bar">
									<div class="audio-level-fill" id="audioLevel"></div>
								</div>
							</div>

							<!-- Right Side: Settings & Join -->
							<div class="setup-controls">
								<div class="device-selectors">
									<div class="input-group">
										<label>Camera</label>
										<select id="cameraSelect" onchange="changeCamera()">
											<option value="">Default Camera</option>
										</select>
									</div>
									<div class="input-group">
										<label>Microphone</label>
										<select id="micSelect" onchange="changeMicrophone()">
											<option value="">Default Microphone</option>
										</select>
									</div>
								</div>

								<div class="join-form">
									<div class="input-group">
										<label>Display Name</label>
										<input
											id="username"
											type="text"
											placeholder="Enter your name"
											maxlength="20"
										/>
									</div>
									<div class="input-group">
										<label>Room ID</label>
										<input
											id="roomId"
											type="text"
											placeholder="Enter room ID"
											value="room123"
										/>
									</div>
									<div
										class="error-message"
										id="errorMessage"
										style="display: none"
									></div>
									<button class="join-btn" onclick="joinRoom()">Join Meeting</button>
								</div>
							</div>
						</div>
					</div>
				</div>

				<!-- Controles de Media -->
				<div
					class="media-controls-bar"
					id="mediaControls"
					style="display: none"
				>
					<div class="controls-left">
						<button
							class="control-btn success"
							onclick="toggleAudio()"
							id="audioBtn"
							title="Toggle Microphone"
						>
							<svg id="audioIcon" viewBox="0 0 24 24" fill="currentColor">
								<path
									d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"
								/>
								<path
									d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"
								/>
							</svg>
						</button>
						<button
							class="control-btn success"
							onclick="toggleVideo()"
							id="videoBtn"
							title="Toggle Camera"
						>
							<svg id="videoIcon" viewBox="0 0 24 24" fill="currentColor">
								<path
									d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"
								/>
							</svg>
						</button>
					</div>
					<div class="controls-center">
						<div class="room-name" id="currentRoom"></div>
					</div>
					<div class="controls-right">
						<button
							class="control-btn"
							onclick="shareRoomLink()"
							id="shareBtn"
							title="Share Room Link"
						>
							<svg viewBox="0 0 24 24" fill="currentColor">
								<path
									d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"
								/>
							</svg>
						</button>
						<button
							class="control-btn"
							onclick="toggleScreenShare()"
							id="screenBtn"
							title="Share Screen"
						>
							<svg id="screenIcon" viewBox="0 0 24 24" fill="currentColor">
								<path
									d="M20 18c1.1 0 1.99-.9 1.99-2L22 6c0-1.11-.9-2-2-2H4c-1.11 0-2 .89-2 2v10c0 1.1.89 2 2 2H0v2h24v-2h-4zM4 6h16v10H4V6z"
								/>
							</svg>
						</button>
						<button
							class="control-btn danger"
							onclick="leaveRoom()"
							title="Leave Room"
						>
							<svg viewBox="0 0 24 24" fill="currentColor">
								<path
									d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11H7v-2h10v2z"
								/>
							</svg>
						</button>
					</div>
				</div>

				<!-- Grid de Videos -->
				<div
					class="videos-container"
					id="videosContainer"
					style="display: none"
				>
					<div class="videos-grid" id="videos">
						<!-- Video Principal -->
						<div class="main-video-wrapper" id="mainVideoWrapper">
							<div class="video-wrapper local" id="wrapper-local">
								<video id="localVideo" autoplay muted playsinline></video>
								<div class="video-overlay">
									<div class="video-label" id="localLabel">You</div>
								</div>
							</div>
						</div>

						<!-- Thumbnails -->
						<div class="thumbnail-videos" id="thumbnailVideos">
							<!-- Los thumbnails se agregan aquÃ­ dinÃ¡micamente -->
						</div>
					</div>
				</div>
			</main>

			<!-- BotÃ³n flotante para abrir chat en mobile -->
			<button
				class="floating-chat-btn"
				id="floatingChatBtn"
				onclick="toggleMobileChat()"
				style="display: none"
			>
				<svg viewBox="0 0 24 24" fill="currentColor" width="26" height="26">
					<path
						d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"
					/>
				</svg>
				<div class="unread-badge" id="unreadBadge" style="display: none">0</div>
			</button>

			<!-- Modal para ver imÃ¡genes -->
			<div class="image-modal" id="imageModal" onclick="closeImageModal(event)">
				<button
					class="image-modal-close"
					onclick="event.stopPropagation(); closeImageModal(event)"
				>
					âœ•
				</button>
				<img id="modalImage" src="" alt="" onclick="event.stopPropagation()" />
			</div>
		</div>

		<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
		<script src="app.js"></script>
	</body>
</html>
